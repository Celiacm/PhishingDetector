<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhishingDetector</title>

    <link rel="icon" type="image/webp" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- Bootstrap 5 (CSS y JS) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        .container {
            margin-top: 20px;
            text-align: center;
        }
        .quote-box, .quiz-box, .map-box, .email-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
        .hidden { display: none; }
        .footer {
            background-color: #343a40;
            color: white;
            padding: 15px 0;
            text-align: center;
            margin-top: 30px;
        }
        @media (max-width: 768px) {
            .navbar-nav {
                text-align: center;
                width: 100%;
            }
        }
        @media (max-width: 768px) {
            .map-box iframe {
                height: 300px; /* Reduce la altura en m√≥viles */
            }
        }
        @media (max-width: 576px) {
            .quiz-box button {
                display: block;
                width: 100%;
                margin-bottom: 10px;
            }
        }
        @media (max-width: 576px) {
            .footer p {
                font-size: 14px;
            }
        }
        .card {
            border-radius: 12px;
            background: #ffffff;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: scale(1.03);
        }

        h4 {
            color: #343a40;
            font-weight: bold;
        }

        .btn-success {
            font-size: 1.2rem;
            padding: 10px 20px;
        }

        #errorReportes {
            font-size: 1.2rem;
        }
        .hero-section h1 {
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
        }

        .card {
            border-radius: 12px;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: scale(1.03);
        }

        .nav-link:hover {
            color: #007bff !important;
            transition: color 0.3s;
        }

        .btn-lg {
            font-size: 1.2rem;
            padding: 10px 20px;
        }
        .loading-screen {
            position: fixed;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }





    </style>
    <script>
        const frases = [
            "El 91% de los ataques cibern√©ticos comienzan con un correo de phishing. ¬°Revisa bien tus mensajes!",
            "Los correos de phishing suelen usar urgencia como estrategia. Si algo parece demasiado urgente, pi√©nsalo dos veces.",
            "M√°s del 70% de los correos fraudulentos usan dominios que imitan empresas leg√≠timas."
        ];

        const quiz = [
            { 
                pregunta: "¬øC√≥mo puedes detectar un correo de phishing?", 
                opciones: ["A) Comprobar el dominio y los enlaces", "B) Hacer clic r√°pido y ver qu√© pasa"],
                correcta: 0,
                explicacion: "Siempre revisa los enlaces antes de hacer clic y verifica el remitente."
            },
            { 
                pregunta: "¬øQu√© debes hacer si recibes un correo sospechoso?", 
                opciones: ["A) Reportarlo y eliminarlo", "B) Responder y preguntar si es leg√≠timo"],
                correcta: 0,
                explicacion: "Nunca respondas a correos sospechosos. Es mejor reportarlos y eliminarlos."
            }
        ];

        function mostrarFrase() {
            const index = Math.floor(Math.random() * frases.length);
            document.getElementById("frase").innerText = frases[index];
        }

        function mostrarQuiz() {
            const index = Math.floor(Math.random() * quiz.length);
            const pregunta = quiz[index];
            document.getElementById("pregunta").innerText = pregunta.pregunta;
            document.getElementById("opcion1").innerText = pregunta.opciones[0];
            document.getElementById("opcion2").innerText = pregunta.opciones[1];
            document.getElementById("opcion1").onclick = () => mostrarResultado(index, 0);
            document.getElementById("opcion2").onclick = () => mostrarResultado(index, 1);
        }

        function mostrarResultado(index, seleccion) {
            const resultadoBox = document.getElementById("resultado");
            if (quiz[index].correcta === seleccion) {
                resultadoBox.innerHTML = "‚úÖ ¬°Correcto!";
            } else {
                resultadoBox.innerHTML = "‚ùå Incorrecto. " + quiz[index].explicacion;
            }
        }

        function showSection(section) {
            document.querySelectorAll('.section').forEach(div => div.classList.add('hidden'));
            document.getElementById(section).classList.remove('hidden');
        }

        window.onload = function() {
            mostrarFrase();
            mostrarQuiz();
        }
        function verDetalles(index) {
            const modalBody = document.getElementById("detallesCorreo");

            // Mensaje de carga mientras se obtiene la informaci√≥n
            modalBody.innerHTML = "<p class='text-center text-muted'>Cargando detalles...</p>";

            // Hacer la solicitud para obtener los detalles
            fetch(`/detalles_correo/${index}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Error al obtener los detalles del correo.");
                    }
                    return response.text();
                })
                .then(data => {
                    modalBody.innerHTML = data; // Cargar el contenido en el modal
                })
                .catch(error => {
                    modalBody.innerHTML = `<p class='text-danger text-center'>No se pudieron cargar los detalles.</p>`;
                    console.error("Error:", error);
                });

            // Mostrar el modal
            new bootstrap.Modal(document.getElementById("modalDetalles")).show();
        }


        document.addEventListener("DOMContentLoaded", function() {
            setTimeout(() => {
                document.getElementById("loading").style.display = "none";
            }, 1500);
        });

        function renderCharts(phishingData, attachmentsData, trendsData) {
            const phishingCtx = document.getElementById('phishingChart').getContext('2d');
            new Chart(phishingCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Seguro ‚úÖ', 'Sospechoso ‚ö†Ô∏è', 'Phishing üö®'],
                    datasets: [{
                        data: phishingData,
                        backgroundColor: ['green', 'orange', 'red']
                    }]
                }
            });

            const attachmentsCtx = document.getElementById('attachmentsChart').getContext('2d');
            new Chart(attachmentsCtx, {
                type: 'bar',
                data: {
                    labels: ['Limpios ‚úÖ', 'Sospechosos ‚ö†Ô∏è', 'Peligrosos üö®'],
                    datasets: [{
                        data: attachmentsData,
                        backgroundColor: ['blue', 'yellow', 'red']
                    }]
                }
            });

            if (trendsData.dates.length > 0) {
                const trendsCtx = document.getElementById('phishingTrendsChart').getContext('2d');
                new Chart(trendsCtx, {
                    type: 'line',
                    data: {
                        labels: trendsData.dates,
                        datasets: [{
                            label: 'Correos Phishing por D√≠a üö®',
                            data: trendsData.counts,
                            borderColor: 'red',
                            backgroundColor: 'rgba(255, 0, 0, 0.2)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            } else {
                document.getElementById("phishingTrendsChart").outerHTML = "<p class='text-muted text-center'>No hay datos de tendencias a√∫n.</p>";
            }
        }

        // Cargar datos de Flask y manejar errores
        fetch('/reportes')
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.warn(data.error);
                    document.getElementById("errorReportes").style.display = "block";
                } else {
                    document.getElementById("errorReportes").style.display = "none";
                    renderCharts(data.phishing_stats, data.attachment_stats, data.trends);
                }
            })
            .catch(error => {
                console.error("Error al cargar reportes:", error);
                document.getElementById("errorReportes").style.display = "block";
            });







    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showSection('inicio')">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" style="height: 40px;">
                <strong class="text-primary">PhishingDetector</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link text-dark fw-bold" href="#" onclick="showSection('correos')">üì¨ Correos Recibidos</a></li>
                    <li class="nav-item"><a class="nav-link text-dark fw-bold" href="#" onclick="showSection('analizador')">üîç Analizador Manual</a></li>
                    <li class="nav-item"><a class="nav-link text-dark fw-bold" href="#" onclick="showSection('reportes')">üìä Visualizaci√≥n y Reportes</a></li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="btn btn-danger" href="{{ url_for('logout') }}">Cerrar Sesi√≥n</a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div id="loading" class="loading-screen">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="text-muted">Cargando...</p>
    </div>

    <div class="container">
        <div id="inicio" class="section">
            <div class="container text-center mt-5">
                <div class="row">
                    <div class="col-md-4">
                        <div class="p-4 border rounded shadow-sm bg-white">
                            <h3 class="text-primary">üõ°Ô∏è Seguridad</h3>
                            <p class="text-muted">Detecta y bloquea correos de phishing antes de que te afecten.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-4 border rounded shadow-sm bg-white">
                            <h3 class="text-success">üìä An√°lisis</h3>
                            <p class="text-muted">Revisa y analiza correos sospechosos con nuestra herramienta.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-4 border rounded shadow-sm bg-white">
                            <h3 class="text-danger">üö® Protecci√≥n</h3>
                            <p class="text-muted">Evita ataques cibern√©ticos con alertas en tiempo real.</p>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-12 d-flex justify-content-center">
                            <a href="#" onclick="showSection('analizador')" class="btn btn-primary btn-lg">üîç Analizar Correo</a>
                        </div>
                    </div>

                </div>
            </div>
            
            
            
            <div class="quote-box">
                <p id="frase"></p>
            </div>
            <div class="quiz-box">
                <p id="pregunta"></p>
                <button class="btn btn-primary" id="opcion1"></button>
                <button class="btn btn-secondary" id="opcion2"></button>
                <p id="resultado" class="mt-3"></p>
            </div>
            <div class="map-box">
                <h4>üåç Riesgo de Phishing Global</h4>
                <iframe src="https://threatmap.checkpoint.com/" width="100%" height="400px" frameborder="0" scrolling="no"></iframe>
            </div>
        </div>

        <div id="correos" class="section hidden">
            <h2 class="text-center">üì¨ Correos Recibidos</h2>
            {% if emails %}
                <div class="list-group">
                    {% for email in emails %}
                        <div class="card shadow-lg p-3 mb-3">
                            <h5 class="fw-bold">{{ email["subject"] }}</h5>
                            <p><strong>De:</strong> {{ email["from"] }}</p>
                            <p><strong>Estado:</strong> 
                                {% if email["is_phishing"] == "Phishing üö® (Alto riesgo)" %}
                                    <span class="text-danger fw-bold">üö® {{ email["is_phishing"] }}</span>
                                {% elif email["is_phishing"] == "Sospechoso ‚ö†Ô∏è (Riesgo moderado)" %}
                                    <span class="text-warning fw-bold">‚ö†Ô∏è {{ email["is_phishing"] }}</span>
                                {% else %}
                                    <span class="text-success fw-bold">‚úÖ {{ email["is_phishing"] }}</span>
                                {% endif %}
                            </p>
                            <button class="btn btn-info btn-sm" onclick="verDetalles('{{ loop.index0 }}')">üîç Ver Detalles</button>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-muted text-center">No hay correos recientes.</p>
            {% endif %}
        </div>
        
        

        <div id="analizador" class="section hidden">
            <h2>üîç Analizador Manual</h2>
            <form action="{{ url_for('analyze_email') }}" method="post" class="mt-3">
                <div class="mb-3">
                    <label for="email_content" class="form-label">Pega el correo aqu√≠:</label>
                    <textarea name="email_content" class="form-control" rows="4" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="email_sender" class="form-label">Remitente:</label>
                    <input type="email" name="email_sender" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="email_subject" class="form-label">Asunto:</label>
                    <input type="text" name="email_subject" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">üîç Analizar</button>
            </form>
        </div>
        <div id="reportes" class="section hidden">
            <h2 class="text-center mt-4">üìä Reportes de Seguridad</h2>
        
            <div class="container mt-4">
                <div class="row">
                    <!-- Gr√°fico de Estado de Correos -->
                    <div class="col-md-6 mb-4">
                        <div class="card shadow-lg p-3">
                            <h4 class="text-center">Estado de Correos üì©</h4>
                            <canvas id="phishingChart"></canvas>
                        </div>
                    </div>
        
                    <!-- Gr√°fico de Archivos Adjuntos -->
                    <div class="col-md-6 mb-4">
                        <div class="card shadow-lg p-3">
                            <h4 class="text-center">Archivos Adjuntos üìé</h4>
                            <canvas id="attachmentsChart"></canvas>
                        </div>
                    </div>
        
                    <!-- Gr√°fico de Tendencias -->
                    <div class="col-12 mb-4">
                        <div class="card shadow-lg p-3">
                            <h4 class="text-center">Tendencias de Phishing üìà</h4>
                            <canvas id="phishingTrendsChart"></canvas>
                        </div>
                    </div>
                </div>
        
                <!-- Bot√≥n para exportar datos -->
                <div class="text-center mt-4">
                    <a href="/exportar_csv" class="btn btn-lg btn-success shadow">üì§ Exportar a CSV</a>
                </div>
            </div>
        
            <!-- Mensaje de error si no hay datos -->
            <p id="errorReportes" class="text-center text-danger mt-3" style="display: none;">Error al obtener reportes.</p>
        </div>
    </div>
    <footer class="footer">
        <p>&copy; 2025 PhishingDetector</p>
        <p>Contacto: <a href="mailto:soporte@gestordecorreos.com" style="color: white;">soporte@gestordecorreos.com</a></p>
    </footer>
    <!-- Modal para mostrar detalles del correo -->
    <div class="modal fade" id="modalDetalles" tabindex="-1" aria-labelledby="modalDetallesLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalDetallesLabel">üì© Detalles del Correo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" id="detallesCorreo">
                    <p class="text-center text-muted">Cargando detalles...</p>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
